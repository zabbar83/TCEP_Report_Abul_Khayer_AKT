select  
                    DISTINCT
                    vta.WING_ID wingId,
                    vta.WING_NAME wingName,
                    vta.DIVISION_ID divisionId,
                    vta.DIVISION_NAME divisionName,
                    vta.TERITORY_ID teritoryId,
                    vta.TERITORY_NAME teritoryName,
                    bru.user_name userName,
                    bru.br_name brName,
                    bru.status attenStatus,
                    statusNo * 25 contactTarget,
                    NVL(bac.essePrime10s,0) essePrime10s,
                    NVL(bac.esseChaMango20s,0) esseChaMango20s,
                    NVL(bac.total_con,0) totalCon,
                    ROUND(case when statusNo * 25 > 0 then (NVL(bac.total_con,0)/(statusNo * 25)) * 100  else 0 end,2) totalConAch,
                    
                    statusNo * 25 samplingTarget,
                    NVL(bac.esseSamp,0) esseSamp,
                    NVL(bac.samplingCon,0) samplingCon,
                    ROUND(case when statusNo * 25 > 0 then (NVL(bac.samplingCon,0)/(statusNo * 25)) * 100  else 0 end,2) samplingAch
            from    (select * from v_teritory_all
            where   division_id like :divisionId || '%'
            and     teritory_id like :teritoryId || '%')vta
            JOIN    (
                    select  
                    bu.teritory_id,
                    br_user,
                    bu.user_name,
                    br.name br_name,
                    status,
                    case when status='PRESENT' then 1 else 0 end statusNo,
                    att_time
            from
                   ((SELECT ba.BR_USER_USER_ID br_user, 'PRESENT' status, TO_CHAR(ba.ATTENDANCE_DATE_TIME, 'dd-mm-yyyy') att_time
                    FROM BRUSER_ATTENDANCE ba  
                    WHERE TO_CHAR(ba.ATTENDANCE_DATE_TIME, 'dd-mm-yyyy')=:targetDate)
                    UNION all
                    (SELECT bul.BR_USER_USER_ID br_user,'ABSENT' status, TO_CHAR(bul.LEAVE_DATE_TIME, 'dd-mm-yyyy') att_time
                    FROM BR_USER_LEAVE bul 
                    WHERE TO_CHAR(bul.LEAVE_DATE_TIME, 'dd-mm-yyyy')=:targetDate)) br_user
                    JOIN BRUSER_ROLES br ON br_user.br_user = br.BRUSER_USER_ID
                    and  ROLES_ID=14
                    JOIN BRUSER bu ON br_user.br_user = bu.USER_ID 
                    AND bu.IS_ACCOUNT_NON_EXPIRED = 1
                    JOIN brand_representative br on bu.user_id=br.br_user_user_id
                    ) bru
                    ON vta.teritory_id=bru.teritory_id
            LEFT    JOIN (select  ba.br_user_id,
                            count(distinct (case when ba.offered_brand = 53 then ba.id else null end)) essePrime10s,
                            count(distinct (case when ba.offered_brand = 54 then ba.id else null end)) esseChaMango20s,
                            count(distinct (case when ba.offered_brand IN (53,54) then ba.id else null end)) total_con,
                            sum(case when ba.offered_brand IN (53,54) then SAMPLING_NO else 0 end) esseSamp,
                            sum(case when ba.offered_brand IN (53,54) and SAMPLING_NO > 0 then 1 else 0 end) samplingCon
                    from    (select * from bractivity where TO_CHAR(TARGET_DATE, 'dd-mm-yyyy')=:targetDate) ba
                    LEFT    JOIN vao_sale vs on ba.id=vs.bractivity_id
                    group   by ba.br_user_id
                    ) bac
                    ON bru.br_user=bac.br_user_id
            ORDER   by vta.WING_ID, vta.DIVISION_ID, vta.TERITORY_ID, bru.user_name