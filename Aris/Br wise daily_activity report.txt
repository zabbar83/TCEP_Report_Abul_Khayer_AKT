select  
        DISTINCT
        vta.WING_ID wingId,
        vta.WING_NAME wingName,
        vta.DIVISION_ID divisionId,
        vta.DIVISION_NAME divisionName,
        vta.TERITORY_ID teritoryId,
        vta.TERITORY_NAME teritoryName,
        bru.user_name userName,
        bru.br_name brName,
        bru.status attenStatus,
        statusNo * 25 contactTarget,
        NVL(bac.orginal,0) orginal,
        NVL(bac.apple,0) apple,
        NVL(bac.strawberry,0) strawberry,
        NVL(bac.total_con,0) totalCon,
        ROUND(case when statusNo * 25 > 0 then (NVL(bac.total_con,0)/(statusNo * 25)) * 100  else 0 end,2) totalConAch,
        statusNo * 25 swappingTarget,
        NVL(bac.swappingCon1,0) swappingCon1,
        NVL(bac.swappingCon6,0) swappingCon6,
        NVL(bac.swappingcon,0) swappingcon,
        ROUND(case when statusNo * 25 > 0 then (NVL(bac.swappingcon,0)/(statusNo * 25)) * 100  else 0 end,2) swappingAch,
        statusNo * 8 vao5sTarget,
        NVL(bac.vao5s,0) vao5s,
        ROUND(case when statusNo * 8 > 0 then (NVL(bac.vao5s,0)/(statusNo * 8)) * 100  else 0 end,2) vao5sAch,
        
        statusNo * 5 vao20sTarget,
        NVL(bac.vaoOrg20s,0) vaoOrg20s,
        ROUND(case when statusNo * 5 > 0 then (NVL(bac.vaoOrg20s,0)/(statusNo * 5)) * 100  else 0 end,2) vaoOrg20sAch,
        NVL(bac.vaoApp20s,0) vaoApp20s,
        ROUND(case when statusNo * 5 > 0 then (NVL(bac.vaoApp20s,0)/(statusNo * 5)) * 100  else 0 end,2) vaoApp20sAch,
        NVL(bac.vaoStr20s,0) vaoStr20s,
        ROUND(case when statusNo * 5 > 0 then (NVL(bac.vaoStr20s,0)/(statusNo * 5)) * 100  else 0 end,2) vaoStr20sAch,
        NVL(bac.vao20s,0) vao20s,
        ROUND(case when statusNo * 5 > 0 then (NVL(bac.vao20s,0)/(statusNo * 5)) * 100  else 0 end,2) vao20sAch,
        
        (statusNo * 8) + (statusNo * 5) vaoTotalTarget,
        NVL(bac.vaototal,0) vaototal,
        ROUND(case when ((statusNo * 8) + (statusNo * 5)) > 0 then (NVL(bac.vaototal,0)/((statusNo * 8) + (statusNo * 5))) * 100  else 0 end,2) vaoTotalAch
from    (select * from v_teritory_all
where   division_id like :divisionId || '%'
and     teritory_id like :teritoryId || '%')vta
JOIN    (
        select  
        bu.teritory_id,
        br_user,
        bu.user_name,
        br.name br_name,
        status,
        case when status='PRESENT' then 1 else 0 end statusNo,
        att_time
from
       ((SELECT ba.BR_USER_USER_ID br_user, 'PRESENT' status, TO_CHAR(ba.ATTENDANCE_DATE_TIME, 'dd-mm-yyyy') att_time
        FROM BRUSER_ATTENDANCE ba  
        WHERE TO_CHAR(ba.ATTENDANCE_DATE_TIME, 'dd-mm-yyyy')=:targetDate)
        UNION all
        (SELECT bul.BR_USER_USER_ID br_user,'ABSENT' status, TO_CHAR(bul.LEAVE_DATE_TIME, 'dd-mm-yyyy') att_time
        FROM BR_USER_LEAVE bul 
        WHERE TO_CHAR(bul.LEAVE_DATE_TIME, 'dd-mm-yyyy')=:targetDate)) br_user
        JOIN BRUSER_ROLES br ON br_user.br_user = br.BRUSER_USER_ID
        and  ROLES_ID=14
        JOIN BRUSER bu ON br_user.br_user = bu.USER_ID 
        AND bu.IS_ACCOUNT_NON_EXPIRED = 1
        JOIN brand_representative br on bu.user_id=br.br_user_user_id
        ) bru
        ON vta.teritory_id=bru.teritory_id
LEFT    JOIN (select  ba.br_user_id,
                count(distinct (case when ba.offered_brand = 32 then ba.id else null end)) orginal,
                count(distinct (case when ba.offered_brand = 33 then ba.id else null end)) apple,
                count(distinct (case when ba.offered_brand = 41 then ba.id else null end)) strawberry,
                count(distinct (case when ba.offered_brand IN (32,33,41) then ba.id else null end)) total_con,
                sum(case when ba.offered_brand IN (32,33,41) and swapping_no =1 then 1 else 0 end) swappingCon1,
                sum(case when ba.offered_brand IN (32,33) and swapping_no =6 then 1 else 0 end) swappingCon6,
                sum(case when ba.offered_brand IN (32,33,41) and swapping_no > 0 then 1 else 0 end) swappingCon,
                sum(case when vs.product_quantity = 5 then vs.quantity else 0 end) vao5s,
                sum(case when ba.offered_brand IN (32) and vs.product_quantity = 20 then vs.quantity else 0 end) vaoOrg20s,
                sum(case when ba.offered_brand IN (33) and vs.product_quantity = 20 then vs.quantity else 0 end) vaoApp20s,
                sum(case when ba.offered_brand IN (41) and vs.product_quantity = 20 then vs.quantity else 0 end) vaoStr20s,
                sum(case when ba.offered_brand IN (32,33,41) and vs.product_quantity = 20 then vs.quantity else 0 end) vao20s,
                sum(case when vs.product_quantity IN(5,20) then vs.quantity else 0 end) vaoTotal
        from    (select * from bractivity where TO_CHAR(TARGET_DATE, 'dd-mm-yyyy')=:targetDate) ba
        LEFT    JOIN vao_sale vs on ba.id=vs.bractivity_id
        group   by ba.br_user_id
        ) bac
        ON bru.br_user=bac.br_user_id
ORDER   by vta.WING_ID, vta.DIVISION_ID, vta.TERITORY_ID, bru.user_name